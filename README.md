# Proxmox-vm-OPNsense
multiple lan interfaces with 1nic



# üß± **OPNsense + Proxmox Multi-LAN Isolation Setup (Write-up)**

## üéØ **‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö**

1.  Proxmox ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ß‡∏á‡∏´‡∏•‡∏±‡∏Å 192.168.0.x
    
2.  ‡∏™‡∏£‡πâ‡∏≤‡∏á VM OPNsense ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô Router
    
3.  ‡πÅ‡∏¢‡∏Å LAN ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏ß‡∏á:
    
    -   **LAN10 = 192.168.10.0/24**
        
    -   **LAN20 = 192.168.20.0/24**
        
4.  ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ß‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏î‡πâ
    
5.  LAN10 ‡πÅ‡∏•‡∏∞ LAN20 **‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏±‡∏ô**
    
6.  LAN ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î **‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ping ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ß‡∏á WAN 192.168.0.x**
    
7.  WAN gateway = 192.168.0.1 (‡πÇ‡∏´‡∏°‡∏î Router ‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô)
    

----------

# üñ• **1. Proxmox Network setup**

Proxmox host:

`192.168.0.66` 

‡∏™‡∏£‡πâ‡∏≤‡∏á Bridges:

Bridge ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö IP ‡∏ö‡∏ô Proxmox
vmbr0    WAN      192.168.0.66
vmbr1    LAN10    ‡πÑ‡∏°‡πà‡∏°‡∏µ IP
vmbr2    LAN20    ‡πÑ‡∏°‡πà‡∏°‡∏µ IP

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**  
‡∏ö‡∏ô vmbr1 ‡πÅ‡∏•‡∏∞ vmbr2 **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á IP** ‡πÄ‡∏ä‡πà‡∏ô:

‚ùå ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á

`address  192.168.10.1/24 address 192.168.20.1/24` 

‡πÄ‡∏û‡∏£‡∏≤‡∏∞ **OPNsense ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ñ‡∏∑‡∏≠ IP**

----------

# üß± **2. OPNsense Interface Assignment**

‡∏†‡∏≤‡∏¢‡πÉ‡∏ô VM:

-   vtnet0 ‚Üí vmbr0 ‚Üí **WAN**
    
-   vtnet1 ‚Üí vmbr1 ‚Üí **LAN1 (192.168.10.1)**
    
-   vtnet2 ‚Üí vmbr2 ‚Üí **LAN2 (192.168.20.1)**
    

‡∏ï‡∏±‡πâ‡∏á IP ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

Interface    IP    Role
WAN    DHCP ‡∏´‡∏£‡∏∑‡∏≠ Static 192.168.0.50    internet in
LAN1    192.168.10.1/24    network 10
LAN2    192.168.20.1/24    network 20

----------

# üì° **3. DHCP Setup ‡∏ö‡∏ô OPNsense**

### LAN1 DHCP (‡∏ß‡∏á 10)

`Range: 192.168.10.100 ‚Äì 192.168.10.200  Gateway: 192.168.10.1  DNS: 192.168.10.1 ‡∏´‡∏£‡∏∑‡∏≠ 1.1.1.1` 

### LAN2 DHCP (‡∏ß‡∏á 20)

`Range: 192.168.20.100 ‚Äì 192.168.20.200  Gateway: 192.168.20.1  DNS: 192.168.20.1 ‡∏´‡∏£‡∏∑‡∏≠ 1.1.1.1` 

----------

# üî• **4. Firewall Rules ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ß‡∏á + ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢**

## ‚≠ê LAN10 Rules (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ)

### Rule 1 ‚Äî Block LAN10 ‚Üí LAN20

`Action: Block  Source: LAN1 net  Destination: 192.168.20.0/24` 

### Rule 2 ‚Äî Block LAN10 ‚Üí WAN subnet

`Action: Block  Source: LAN1 net  Destination: 192.168.0.0/24` 

### Rule 3 ‚Äî Allow Internet

`Action: Pass  Source: LAN1 net  Destination: any` 

----------

## ‚≠ê LAN20 Rules (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏Ñ‡πà‡∏™‡∏•‡∏±‡∏ö‡∏ß‡∏á)

### Rule 1 ‚Äî Block LAN20 ‚Üí LAN10

`Source: LAN2 net  Destination: 192.168.10.0/24` 

### Rule 2 ‚Äî Block LAN20 ‚Üí WAN subnet

`Source: LAN2 net  Destination: 192.168.0.0/24` 

### Rule 3 ‚Äî Allow Internet

`Source: LAN2 net  Destination: any` 

----------

# üåç **5. NAT (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)**

‡πÑ‡∏õ‡∏ó‡∏µ‡πà:

`Firewall ‚Üí NAT ‚Üí Outbound` 

‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:

`Automatic  Outbound  NAT` 

‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ LAN10 ‡πÅ‡∏•‡∏∞ LAN20 ‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

----------

# üß™ **6. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå**

‡∏à‡∏≤‡∏Å LAN10 (192.168.10.x):

`ping  192.168.0.1 ‚Üí timeout  (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
ping 192.168.20.1 ‚Üí timeout  (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
ping 8.8.8.8 ‚Üí ‡πÑ‡∏î‡πâ     (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
curl ipify.org      ‚Üí ‡πÑ‡∏î‡πâ IP ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï` 

LAN20 ‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
